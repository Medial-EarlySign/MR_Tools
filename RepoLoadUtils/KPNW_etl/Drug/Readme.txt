Readme file for Drug mapping generation in KPNW:
------------------------------------------------

Contents:
* generate_drugs_dicts.py : main mapping generation script. Uses many different sources of information and tries to match the ATC for each drug code.
* finalize_drug_dict.py : last stage of mapping
* drug_names3 : list of all possible drugs in KP : col1: counts, col2: NDC code, or MISSING-<code> (generated by us), col3: actual drug name (the item we used to identify a drug)
* atc_codes: col1: atc code ,col2: atc code description
* ndc_atc4_2019.csv : a 2019 snapshot of the table mapping ndc to top5 letters of atc using RxNorm web crawling scripts.
* synonyms : a table (manually generated) mapping names to similar names (like ACETAMINOPHEN to PARACETAMOL, etc). This could be improved.
* product.txt : a table from the fda site contatining fuller descriptions of all the ndc coded products.
* drug_names_map.csv : mapping from KP dictionary drug codes to drug strings col1: drug name (String) , col2: KP:<number> code . Tab delimited.

generate_drugs_dicts.py general idea:
For each ndc code : collect all the drugs that had it in kp drugs table, and in the product code, and collect all the words that are included in it. Normalize the words, get rid of non important words, and then search the words in the atc codes descriptions. Then score each ATC code using the words contained in the description (and their weight), coverage, and add extra points for having the same prefix as the ndc to atc table. Once done, choose the best matchings as a match.

To run , use the following command:
generate_drugs_dicts.py drug_names3 atc_codes ndc_atc4_2019.csv sysnonyms product.txt > output.run
grep Deci output.run > run.ndc2atc


To complete the work use the finalize_drug_dict.py script:
finalize_drug_dict.py drug_names3 run.ndc2atc drug_names_map.csv > run8.final
less run8.final | grep MAP | sed 's/{/\[/g' | sed 's/}/\]/g' | grep -v NONE > mapping_drug_names_to_atc
